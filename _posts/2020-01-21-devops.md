---
bá»‘ cá»¥c: bÃ i
title: Mayx Váº­n hÃ nh vÃ  Báº£o trÃ¬ Ghi chÃº-Tá»‘i Æ°u hÃ³a á»¨ng dá»¥ng
tags: [Váº­n hÃ nh vÃ  báº£o trÃ¬, ghi chÃº, tá»‘i Æ°u hÃ³a]
---

tá»‘i Æ°u hÃ³a? NÃ³ Ä‘á»§ tá»‘t Ä‘á»ƒ Ä‘Ã¡p á»©ng tá»‘i Æ°u hÃ³a! <! - more ->

# Tiáº¿p tá»¥c tá»‘i Æ°u hÃ³a!
Sau khi xÃ¢y dá»±ng láº¡i [bÃ i viáº¿t trÆ°á»›c] (/ 2020/01/05 / devops.html), láº§n trÆ°á»›c tÃ´i Ä‘Ã£ thá»±c hiá»‡n má»™t sá»‘ tá»‘i Æ°u hÃ³a mÃ´i trÆ°á»ng há»‡ thá»‘ng, nhÆ°ng há»‡ thá»‘ng Discuz Ä‘Æ°á»£c sá»­ dá»¥ng trong diá»…n Ä‘Ã n cÅ©ng Ä‘Æ°á»£c coi lÃ  má»™t á»©ng dá»¥ng trÆ°á»Ÿng thÃ nh ~~ (Tháº­t khÃ´ng may, khÃ´ng Cho dÃ¹ báº¡n trÆ°á»Ÿng thÃ nh Ä‘áº¿n Ä‘Ã¢u, báº¡n sáº½ khÃ´ng bao giá» viáº¿t mÃ£ cá»§a riÃªng mÃ¬nhğŸ˜‚) ~~, vÃ¬ váº­y láº§n nÃ y tÃ´i dá»± Ä‘á»‹nh tá»‘i Æ°u hÃ³a trÃªn á»©ng dá»¥ng Discuz.
NhÆ°ng xÃ©t cho cÃ¹ng, vá»›i trÃ¬nh Ä‘á»™ PHP cá»§a tÃ´i, tÃ´i khÃ´ng thá»ƒ sá»­a Ä‘á»•i nÃ³ trá»±c tiáº¿p trÃªn mÃ£ nguá»“n, vÃ¬ váº­y tÃ´i dá»± Ä‘á»‹nh sá»­ dá»¥ng chá»©c nÄƒng tá»‘i Æ°u hÃ³a riÃªng cá»§a Discuz Ä‘á»ƒ tá»‘i Æ°u hÃ³a.

# Giá»›i thiá»‡u vá» viá»‡c tá»‘i Æ°u hÃ³a thÆ° viá»‡n xá»­ lÃ½ áº£nh
Trong báº£ng Ä‘iá»u khiá»ƒn ná»n cá»§a Discuz, nÆ¡i Ä‘áº§u tiÃªn tÃ´i tháº¥y vá» tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t lÃ  thÆ° viá»‡n xá»­ lÃ½ hÃ¬nh áº£nh ~~ (máº·c dÃ¹ nÃ³ khÃ´ng pháº£i lÃ  láº§n Ä‘áº§u tiÃªn xuáº¥t hiá»‡n) ~~. NhÃ¬n vÃ o pháº§n giá»›i thiá»‡u bÃªn cáº¡nh, thÆ° viá»‡n GD máº·c Ä‘á»‹nh cÃ³ váº» ngá»‘n tÃ i nguyÃªn há»‡ thá»‘ng hÆ¡n, ngÆ°á»£c láº¡i thÆ° viá»‡n ImageMagick thÃ¬ tá»‘t hÆ¡n, vÃ¬ nÃ³ nÃ³i nhÆ° váº­y nÃªn tÃ´i cháº¯c cháº¯n Ä‘Ã£ chá»n thÆ° viá»‡n ImageMagick mÃ  khÃ´ng cáº§n Ä‘áº¯n Ä‘o.
Táº¥t nhiÃªn, tÃ´i thá»±c sá»± Ä‘Ã£ lÃ m Ä‘iá»u nÃ y, nhÆ°ng hoáº¡t Ä‘á»™ng nÃ y dÆ°á»ng nhÆ° cÃ³ má»™t sá»‘ váº¥n Ä‘á» khÃ´ng mong muá»‘n. Sau khi sá»­a Ä‘á»•i tÃ¹y chá»n nÃ y, tÃ´i báº¯t Ä‘áº§u duyá»‡t diá»…n Ä‘Ã n, nhÆ°ng tÃ´i tháº¥y ráº±ng cÃ³ váº¥n Ä‘á» vá»›i hiá»ƒn thá»‹ hÃ¬nh áº£nh thu nhá» cá»§a nhiá»u bÃ i viáº¿t trong diá»…n Ä‘Ã n. LÃºc nÃ y, tÃ´i cáº£m tháº¥y cÃ³ Ä‘iá»u gÃ¬ Ä‘Ã³ khÃ´ng á»•n. TrÆ°á»›c háº¿t, tÃ´i Ä‘áº£m báº£o ráº±ng LEMP trong Vultr pháº£i Ä‘Æ°á»£c cÃ i Ä‘áº·t ImageMagick. Äá»‘i vá»›i thÆ° viá»‡n, váº¥n Ä‘á» cháº¯c cháº¯n khÃ´ng pháº£i lÃ  váº¥n Ä‘á» vá»›i mÃ´i trÆ°á»ng PHP cá»§a tÃ´i. Táº¡i thá»i Ä‘iá»ƒm nÃ y, tÃ´i nghi ngá» ráº±ng cÃ³ thá»ƒ cÃ³ váº¥n Ä‘á» vá»›i nhá»¯ng thá»© Ä‘Æ°á»£c lÆ°u trá»¯ trong cÆ¡ sá»Ÿ dá»¯ liá»‡u. Tuy nhiÃªn, váº¥n Ä‘á» nÃ y náº±m ngoÃ i pháº¡m vi giáº£i quyáº¿t cá»§a tÃ´i, khÃ´ng cÃ³ cÃ¡ch nÃ o, tÃ´i Ä‘Ã nh pháº£i khÃ´i phá»¥c láº¡i cÃ¡c tÃ¹y chá»n ğŸ˜“, dÃ¹ sao cÅ©ng Ä‘Ã£ qua nhiá»u nÄƒm nhÆ° váº­y, cháº¯c cÅ©ng khÃ´ng áº£nh hÆ°á»Ÿng nhiá»u láº¯m.

# Giá»›i thiá»‡u vá» tá»‘i Æ°u hÃ³a bá»™ nhá»› cache
Trong Há»c viá»‡n PhÃ¡o hoa trÆ°á»›c Ä‘Ã¢y, tÃ´i cÅ©ng Ä‘Ã£ sá»­ dá»¥ng bá»™ nhá»› Ä‘á»‡m cá»§a Discuz vÃ  cÃ´ng cá»¥ lÃ  MemCache. TrÃªn thá»±c táº¿, LEMP khÃ´ng cung cáº¥p pháº§n má»Ÿ rá»™ng MemCache theo máº·c Ä‘á»‹nh mÃ  thay vÃ o Ä‘Ã³ lÃ  pháº§n má»Ÿ rá»™ng cá»§a Redis. Tuy nhiÃªn, tÃ´i nhÃ¬n vÃ o biá»ƒu tÆ°á»£ng mÃ u Ä‘á» cá»§a Redis vÃ  khÃ´ng hiá»ƒu sao trong lÃ²ng luÃ´n cÃ³ cáº£m giÃ¡c pháº£n khÃ¡ng, sau nÃ y hiá»ƒu ra thÃ¬ Redis cÃ³ váº» hoáº¡t Ä‘á»™ng tá»‘t hÆ¡n nhiá»u so vá»›i MemCache, vÃ¬ váº­y tÃ´i khÃ´ng nghi ngá» gÃ¬ vá» viá»‡c cá»‘ gáº¯ng lÃ m cÃ i Ä‘áº·t nÃ³.
NhÆ°ng trÃªn thá»±c táº¿, tÃ´i khÃ´ng thá»±c sá»± tin ráº±ng bá»™ nhá»› Ä‘á»‡m nÃ y cÃ³ thá»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t Ä‘áº¿n má»©c nÃ o, chá»‰ cáº§n xem Internet nÃ³i ráº±ng cÃ¡c tá»‘c Ä‘á»™ tÄƒng tá»‘c khÃ¡c nhau Ä‘áº¿n 0,005 giÃ¢y lÃ  ráº¥t thÃº vá»‹. Rá»‘t cuá»™c, bá»™ nhá»› mÃ¡y chá»§ cá»§a tÃ´i khÃ´ng lá»›n, tá»•ng cá»™ng lÃ  1 G, vÃ  Swap Ä‘Æ°á»£c thÃªm vÃ o. Náº¿u bá»™ nhá»› Ä‘á»‡m chiáº¿m nhiá»u bá»™ nhá»›, vÃ  nÃ³ Ä‘Æ°á»£c cáº¥p phÃ¡t vÃ  cáº¥p phÃ¡t rá»“i tráº£ vá» Ä‘Ä©a cá»©ng nÆ¡i Ä‘áº·t Swap, thÃ¬ viá»‡c tá»‘i Æ°u hÃ³a cá»§a tÃ´i cÃ³ máº¥t Ä‘i Ã½ nghÄ©a cá»§a nÃ³ khÃ´ng? NhÆ°ng tÃ´i luÃ´n ghen tá»‹ vá»›i blog cá»§a ngÆ°á»i khÃ¡c, vÃ¬ váº­y tÃ´i báº¯t Ä‘áº§u nghiÃªn cá»©u cÃ¡ch lÃ m bá»™ nhá»› Ä‘á»‡m cá»§a Redis.
## Má»™t hÃ nh trÃ¬nh khÃ³ khÄƒn Ä‘áº¿n Redis
Redis cÃ i Ä‘áº·t khÃ´ng khÃ³, chá»‰ cáº§n má»™t cÃ¢u lÃ  `yum install redis`, khÃ³ khÄƒn chÃ­nh náº±m á»Ÿ cáº¥u hÃ¬nh.
TÃ´i biáº¿t, táº¡i thá»i Ä‘iá»ƒm nÃ y, chá»‰ cáº§n thÃªm má»™t cÃ¢u `` $ _config ['memory'] ['redis'] ['server'] = '127.0.0.1'; 'trong tá»‡p cáº¥u hÃ¬nh cá»§a Discuz, rá»“i khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥ Redis theo cÃ¡ch máº·c Ä‘á»‹nh. NS. NhÆ°ng vÃ¬ tÃ´i Ä‘Ã£ nÃ³i trÆ°á»›c ráº±ng khÃ´ng nÃªn sá»­ dá»¥ng cÃ¡c socket TCP / IP trong cÃ¡c dá»‹ch vá»¥ ná»™i bá»™, nÃªn tÃ´i cháº¯c cháº¯n khÃ´ng thá»ƒ cho phÃ©p nÃ³ hoáº¡t Ä‘á»™ng vá»›i cáº¥u hÃ¬nh máº·c Ä‘á»‹nh.
Trong Redis, cÃ³ má»™t tÃ¹y chá»n há»— trá»£ á»• cáº¯m miá»n UNIX vÃ  nÃ³ cÅ©ng há»— trá»£ táº¯t giÃ¡m sÃ¡t Cá»•ng TCP / IP. TÃ´i Ä‘Ã£ Ä‘á»‹nh cáº¥u hÃ¬nh nÃ³ theo hÆ°á»›ng dáº«n á»Ÿ trÃªn vÃ  Ä‘áº·t nÃ³ trong tá»‡p cáº¥u hÃ¬nh má»™t cÃ¡ch tá»± tin. Tuy nhiÃªn, thá»±c táº¿ cho tÃ´i biáº¿t ráº±ng nÃ³ khÃ´ng Ä‘Æ¡n giáº£n nhÆ° váº­y, tÃ´i Ä‘Ã£ viáº¿t má»™t Ä‘oáº¡n script thá»­ nghiá»‡m vÃ  nÃ³ tráº£ vá» thÃ´ng bÃ¡o `` KhÃ´ng cÃ³ tá»‡p hoáº·c thÆ° má»¥c nÃ o nhÆ° váº­y`? TÃ´i liÃªn tá»¥c xÃ¡c nháº­n láº¡i Ä‘Æ°á»ng dáº«n Ä‘á»ƒ cháº¯c cháº¯n ráº±ng mÃ¬nh khÃ´ng viáº¿t sai Ä‘Æ°á»ng dáº«n. Sau Ä‘Ã³, tÃ´i Ä‘Ã£ tÃ¬m kiáº¿m trÃªn Internet Ä‘á»ƒ tÃ¬m lá»—i nÃ y, sau khi kiá»ƒm tra má»™t thá»i gian dÃ i, khÃ´ng cÃ³ káº¿t quáº£ nÃ o ... TÃ´i tháº­m chÃ­ cÃ²n Ä‘áº·t quyá»n Ä‘á»‘i vá»›i 777 vÃ  thÃªm php-fpm vÃ o nÃ³. NhÃ³m redis khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng vÃ  tÃ´i cÅ©ng Ä‘Ã£ sá»­ dá»¥ng redis-cli Ä‘á»ƒ xÃ¡c nháº­n ráº±ng tá»‡p thá»±c sá»± lÃ  tá»‡p socket. LÃºc nÃ y, tÃ´i thá»±c sá»± khÃ´ng cÃ²n gÃ¬ Ä‘á»ƒ lÃ m. KhÃ´ng thá»ƒ nÃ o, tÃ´i Ä‘Ã£ pháº£i suy nghÄ© cáº©n tháº­n.
TÃ´i nghÄ© ráº±ng váº¥n Ä‘á» nÃ y váº«n nÃªn náº±m á»Ÿ quyá»n, nhÆ°ng váº¥n Ä‘á» nÃ y lÃ  quÃ¡ láº¡ Ä‘á»ƒ hiá»ƒu. Theo cáº¥u hÃ¬nh máº·c Ä‘á»‹nh, tá»‡p socket náº±m trong thÆ° má»¥c / tmp /, vÃ¬ PHP cÅ©ng sá»­ dá»¥ng thÆ° má»¥c nÃ y khi táº£i tá»‡p lÃªn, vÃ¬ váº­y tÃ´i khÃ´ng nghi ngá» nhiá»u vá» nÃ³. NhÆ°ng mysql cá»§a tÃ´i cÅ©ng sá»­ dá»¥ng cÃ¡c socket miá»n UNIX, nhÆ°ng tá»‡p náº±m dÆ°á»›i / run /, vÃ  khÃ´ng cÃ³ váº¥n Ä‘á» gÃ¬, tÃ´i Ä‘Ã£ nghÄ© Ä‘áº¿n Ä‘iá»u Ä‘Ã³, cÃ³ thá»ƒ Ä‘áº·t tá»‡p socket nÃ y dÆ°á»›i thÆ° má»¥c / run / vÃ  nÃ³ sáº½ hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng. Tháº­t khÃ´ng ngá», Ä‘Ã³ thá»±c sá»± lÃ  váº¥n Ä‘á». Khi tÃ´i thay Ä‘á»•i Ä‘Æ°á»ng dáº«n trong tá»‡p cáº¥u hÃ¬nh, nÃ³ cÅ©ng hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng ... TÃ´i thá»±c sá»± khÃ´ng nÃ³i nÃªn lá»i ...
Sau Ä‘Ã³, tÃ´i Ä‘áº·t dá»‹ch vá»¥ redis tá»± Ä‘á»™ng báº¯t Ä‘áº§u sau khi khá»Ÿi Ä‘á»™ng vÃ  sau Ä‘Ã³ quÃ¡ trÃ¬nh tá»‘i Æ°u hÃ³a nÃ y káº¿t thÃºc á»Ÿ Ä‘Ã¢y.

# Viá»‡c nhÃ  khÃ¡c
KhÃ´ng cÃ³ nhiá»u lÄ©nh vá»±c khÃ¡c cÃ³ thá»ƒ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a. Sau nÃ y, tÃ´i kiá»ƒm tra vÃ  tháº¥y ráº±ng khá»‘i lÆ°á»£ng yÃªu cáº§u cá»§a Há»c viá»‡n Huahuo Ä‘á»™t nhiÃªn tÄƒng gáº¥p Ä‘Ã´i khi cÃ³ sá»± cá»‘ vÃ o ngÃ y hÃ´m Ä‘Ã³. CÃ³ láº½ Ä‘Ã¢y lÃ  lÃ½ do khiáº¿n Há»c viá»‡n Huahuo trÆ°á»›c Ä‘Ã³ buá»™c pháº£i dá»«ng láº¡i. tá»‘i Æ°u hÃ³a váº«n ráº¥t quan trá»ng.
Má»™t khÃ­a cáº¡nh khÃ¡c lÃ  Ä‘iá»u chá»‰nh quyá»n Discuz, tÃ´i khÃ´ng biáº¿t táº¡i sao luÃ´n cÃ³ má»™t sá»‘ ngÆ°á»i muá»‘n Ä‘Äƒng bÃ i trong khu vá»±c bÃ i kiá»ƒm tra, há» thá»±c sá»± khÃ´ng thá»ƒ hiá»ƒu Ä‘Æ°á»£c hoáº¡t Ä‘á»™ng cá»§a chÃºng, váº¥n Ä‘á» khÃ¡c lÃ  váº¥n Ä‘á» Ä‘Äƒng liÃªn tá»¥c. TÃ´i nghÄ© má»™t sá»‘ ngÆ°á»i sá»­ dá»¥ng mÃ¡y Ä‘Äƒng bÃ i Ä‘á»ƒ lÃ m Ä‘iá»u Ä‘Ã³ Diá»…n Ä‘Ã n cá»§a chÃºng tÃ´i, vÃ¬ váº­y chÃºng tÃ´i nÃ¢ng ngÆ°á»¡ng Ä‘Äƒng bÃ i lÃªn má»™t chÃºt.
Thá»±c táº¿ thÃ¬ láº§n nÃ y khÃ´ng cÃ³ thay Ä‘á»•i gÃ¬ lá»›n, chÃ­nh lÃ  Redis nÃ y, tÃ´i Ä‘Ã£ thá»±c sá»± bÃ¹ng ná»• ngay táº¡i chá»—, cÃ³ váº» nhÆ° tÃ´i váº«n pháº£i cáº£i thiá»‡n tháº¿ tráº­n cá»§a mÃ¬nh á»Ÿ cáº¥p Ä‘á»™ 23333.
