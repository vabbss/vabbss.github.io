---
bá»‘ cá»¥c: bÃ i
tiÃªu Ä‘á»: Ghi chÃº váº­n hÃ nh vÃ  báº£o trÃ¬ Mayx
tags: [Váº­n hÃ nh vÃ  báº£o trÃ¬, ghi chÃº]
---

NÄƒm má»›i lá»—i má»›i! <! - more ->

# Báº¯t Ä‘áº§u
HÃ´m kia, [èŠ±ç« å­¦å›­] (https://www.say-huahuo.com) mÃ  tÃ´i duy trÃ¬ Ä‘Ã£ bá»‹ há»ng. Bá»Ÿi vÃ¬ Ä‘á»§ loáº¡i thá»© lá»™n xá»™n Ä‘Æ°á»£c cÃ i Ä‘áº·t trÃªn Ä‘Ã³, tÃ´i nghÄ© nÃ³ chá»‰ lÃ  má»™t cÃ¡i mÃ¡y Ä‘Ã¡nh bÃ i hÃ ng ngÃ y. VÃ¬ váº­y, tÃ´i chá»‰ cáº§n khá»Ÿi Ä‘á»™ng láº¡i nÃ³.
Sau khi khá»Ÿi Ä‘á»™ng láº¡i, trá»i láº¡nh. TÃ´i khÃ´ng biáº¿t táº¡i sao vÃ  cÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ´ng thá»ƒ káº¿t ná»‘i Ä‘Æ°á»£c ... VÃ¬ váº­y, tÃ´i báº¯t Ä‘áº§u há»i má»™t ngÆ°á»i khÃ¡c cÅ©ng cÃ³ thá»ƒ Ä‘Äƒng nháº­p vÃ o mÃ¡y chá»§ vÃ  há»i anh ta xem anh ta Ä‘Ã£ cháº¡m vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u chÆ°a. CÃ³ váº» nhÆ° anh ta Ä‘Ã£ khÃ´ng á»Ÿ trong nhiá»u thÃ¡ng. HÃ£y Ä‘Äƒng nháº­p vÃ o mÃ¡y chá»§. VÃ¬ váº­y, tÃ´i Ä‘Ã£ hoáº£ng sá»£ vÃ  cá»‘ gáº¯ng khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥ MySQL theo cÃ¡ch thá»§ cÃ´ng, nhÆ°ng dÃ²ng chá»¯ "Job for mysql.service fail" láº¡nh lÃ¹ng trong giao diá»‡n mÃ u Ä‘en cho tÃ´i biáº¿t ráº±ng má»i thá»© khÃ´ng Ä‘Æ¡n giáº£n nhÆ° váº­y. TÃ´i Ä‘Ã£ lÃ m theo lá»i nháº¯c sai Ä‘á»ƒ kiá»ƒm tra thÃ´ng tin chi tiáº¿t, nhÆ°ng Ä‘Ã³ chá»‰ lÃ  má»™t cÃ¢u Ä‘Æ¡n giáº£n vÃ  Ä‘Æ¡n giáº£n nhÆ° `mysql.service: Main process thoÃ¡t, code = exited, status = 1 / FAILURE` ... Ä‘iá»u nÃ y vÃ  khÃ´ng nÃ³i báº¥t ká»³ Ä‘iá»u gÃ¬ sá»± khÃ¡c biá»‡t ... Má»i ngÆ°á»i Ä‘á»u biáº¿t ráº±ng nÃ³ khÃ´ng báº¯t Ä‘áº§u ...
KhÃ´ng thá»ƒ nÃ o, lÃºc nÃ y chá»‰ cÃ³ thá»ƒ cáº§u cá»©u tháº¿ há»‡ trÆ°á»›c váº­n hÃ nh báº£o trÃ¬ trang web ~~ (cÃºi Ä‘áº§u láº¡y Ã´ng chá»§) ~~ Sau khi Ã´ng chá»§ khÃ´ng biáº¿t váº­n hÃ nh kiá»ƒu gÃ¬, cuá»‘i cÃ¹ng cÅ©ng tÃ¬m ra Ä‘Æ°á»£c lá»—i tháº­t chi tiáº¿t. , cÃ³ váº» nhÆ° cÃ³ CÃ³ váº¥n Ä‘á» vá»›i báº£ng ngÆ°á»i dÃ¹ng trong cÆ¡ sá»Ÿ dá»¯ liá»‡u. VÃ¬ váº­y, Ã´ng chá»§ Ä‘áº·t láº¡i báº£ng ngÆ°á»i dÃ¹ng, vÃ  cuá»‘i cÃ¹ng miá»…n cÆ°á»¡ng khá»Ÿi Ä‘á»™ng láº¡i dá»‹ch vá»¥ MySQL.
NhÆ°ng ngay cáº£ khi báº¡n thá»±c hiá»‡n má»™t sá»‘ cáº¥u hÃ¬nh Ä‘Æ¡n giáº£n táº¡i thá»i Ä‘iá»ƒm nÃ y, nÃ³ sáº½ gáº§n nhÆ° sáºµn sÃ ng Ä‘á»ƒ trá»±c tuyáº¿n trá»Ÿ láº¡i, nhÆ°ng sau khi suy nghÄ© vá» nÃ³, Ä‘á»ƒ ngÄƒn cháº·n nhá»¯ng thá»© lá»™n xá»™n trong tÆ°Æ¡ng lai, tÃ´i dá»± Ä‘á»‹nh di chuyá»ƒn láº¡i trang web vÃ  thá»±c hiá»‡n chÃ­nh cáº­p nháº­t lÃªn mÃ´i trÆ°á»ng há»‡ thá»‘ng.!

# QuÃ¡ trÃ¬nh tÃ¡i táº¡o
TrÆ°á»›c tiÃªn chÃºng ta hÃ£y thuÃª má»™t mÃ¡y chá»§ má»›i, trÆ°á»›c Ä‘Ã¢y tÃ´i Ä‘Ã£ sá»­ dá»¥ng mÃ¡y chá»§ Ubuntu, nay Ä‘Ã£ má»™t nÄƒm trÃ´i qua, Ä‘Ã£ Ä‘áº¿n lÃºc tÃ­nh Ä‘áº¿n sá»± á»•n Ä‘á»‹nh nÃªn tÃ´i Ä‘Ã£ Ä‘á»•i há»‡ thá»‘ng sang CentOS.
Sau Ä‘Ã³, Ä‘á»ƒ tiá»‡n cho viá»‡c cáº¥u hÃ¬nh sau nÃ y, tÃ´i váº«n quyáº¿t Ä‘á»‹nh sá»­ dá»¥ng á»©ng dá»¥ng LEMP mÃ  nhÃ  cung cáº¥p mÃ¡y chá»§ Ä‘Ã£ cáº¥u hÃ¬nh sáºµn, Ä‘á»ƒ sau khi xÃ¢y dá»±ng xong, tÃ´i khÃ´ng cÃ²n pháº£i nghÄ© Ä‘áº¿n viá»‡c cÃ i Ä‘áº·t pháº§n má»m mÃ¡y chá»§ ná»¯a.
Trong quÃ¡ trÃ¬nh triá»ƒn khai mÃ¡y chá»§ má»›i, tÃ´i quay láº¡i mÃ¡y chá»§ ban Ä‘áº§u, báº¯t Ä‘áº§u Ä‘Ã³ng gÃ³i cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  cÃ¡c táº­p tin cá»§a trang web, chuáº©n bá»‹ chuyá»ƒn sang mÃ¡y chá»§ má»›i.
KhÃ´ng máº¥t nhiá»u thá»i gian Ä‘á»ƒ mÃ¡y chá»§ má»›i Ä‘Æ°á»£c triá»ƒn khai, vÃ¬ váº­y tÃ´i Ä‘Ã£ chuyá»ƒn trá»±c tiáº¿p táº¥t cáº£ cÃ¡c tá»‡p sang mÃ¡y chá»§ má»›i báº±ng má»™t `scp` duy nháº¥t. TÃ´i pháº£i nÃ³i ráº±ng tá»‘c Ä‘á»™ cá»§a mÃ¡y chá»§ trá»±c tiáº¿p truyá»n tá»‡p thá»±c sá»± nhanh chÃ³ng, vÃ  má»™t vÃ i tá»‡p GiB cÃ³ thá»ƒ Ä‘Æ°á»£c chuyá»ƒn trong vÃ i phÃºt. NhÃ¢n tiá»‡n, dá»¯ liá»‡u cá»§a Há»c viá»‡n Huahuo thá»±c sá»± lÃ  vÃ i GiB. TÃ´i nghÄ© ráº±ng nÃ³ Ã­t hÆ¡n 2 GiB khi tÃ´i tiáº¿p quáº£n.
Sau Ä‘Ã³ nháº­p cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  giáº£i nÃ©n cÃ¡c táº­p tin trang web, cáº¥u hÃ¬nh Nginx, sau khi hoÃ n thÃ nh cÃ³ thá»ƒ sá»­ dá»¥ng trang web bÃ¬nh thÆ°á»ng nhÆ° mong Ä‘á»£i.
Sau Ä‘Ã³ lÃ  nhá»¯ng thá»© lá»™n xá»™n nhÆ° thiáº¿t láº­p DNS, vÃ  CDN cá»§a Cloudflare, nhÆ°ng may máº¯n thay, cáº¥u hÃ¬nh cá»§a danh sÃ¡ch tráº¯ng tÆ°á»ng lá»­a Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p trÆ°á»›c Ä‘Ã³, vÃ  láº§n nÃ y cÅ©ng thuáº­n tiá»‡n hÆ¡n ráº¥t nhiá»u.
NhÆ°ng Ä‘iá»u nÃ y váº«n chÆ°a káº¿t thÃºc. BÃ¢y giá» tÃ´i Ä‘Ã£ Ä‘á»•i sang má»™t mÃ¡y chá»§ má»›i vÃ  tÃ´i Ä‘Ã£ hiá»ƒu rÃµ hÆ¡n vá» mÃ¡y chá»§ nÄƒm nay, Ã­t nháº¥t tÃ´i nÃªn thá»±c hiá»‡n má»™t sá»‘ tá»‘i Æ°u hÃ³a.
VÃ¬ váº­y, tÃ´i Ä‘Ã£ cÃ i Ä‘áº·t BBR trÆ°á»›c. Tháº­t lÃ  ráº¯c rá»‘i khi pháº£i lÃ m quÃ¡ nhiá»u thá»©, vÃ¬ váº­y tÃ´i Ä‘Ã£ trá»±c tiáº¿p sá»­ dá»¥ng [Táº­p lá»‡nh má»™t cÃº nháº¥p chuá»™t] (https://github.com/teddysun/across/blob/master/bbr.sh). NhÃ¢n tiá»‡n mÃ¬nh lÃ m láº¡i HoÃ¡n Ä‘á»•i, dÃ¹ sao mÃ¡y chá»§ chá»‰ cÃ³ bá»™ nhá»› 1GiB nÃªn dÃ¹ng thÃªm bá»™ nhá»›, tuy tá»‘c Ä‘á»™ cÃ³ thá»ƒ giáº£m nhÆ°ng mÃ¬nh váº«n muá»‘n á»•n Ä‘á»‹nh, hÆ¡n ná»¯a mÃ¡y chá»§ cÃ³ váº» lÃ  á»• SSD Ä‘Ä©a cá»©ng, sáº½ cÃ³ Ã­t tÃ¡c dá»¥ng.
á» thá»i Ä‘iá»ƒm nÃ y, tÃ´i nghÄ© mÃ¬nh Ä‘Ã£ hoÃ n thÃ nh tá»‘t cÃ´ng viá»‡c á»Ÿ mÃ´i trÆ°á»ng cÆ¡ báº£n.

# Sau khi tá»‘i Æ°u hÃ³a
VÃ o ngÃ y thá»© hai, tÃ´i láº¡i báº¥t chá»£t vÃ  muá»‘n lÃ m Ä‘iá»u gÃ¬ Ä‘Ã³ khÃ¡c Ä‘á»ƒ tá»‘i Æ°u hÃ³a mÃ¡y chá»§. TrÆ°á»›c háº¿t, má»¥c tiÃªu cá»§a tÃ´i lÃ  thay tháº¿ táº¥t cáº£ cÃ¡c á»• cáº¯m TCP / IP ná»™i bá»™ báº±ng cÃ¡c á»• cáº¯m miá»n UNIX. Sá»­ dá»¥ng cÃ¡c á»• cáº¯m miá»n UNIX cÃ³ thá»ƒ giáº£m ráº¥t nhiá»u chi phÃ­ há»‡ thá»‘ng., VÃ¬ váº­y, tÃ´i báº¯t Ä‘áº§u vá»›i PHP-FPM.
TrÃªn thá»±c táº¿, thay Ä‘á»•i ráº¥t Ä‘Æ¡n giáº£n, Ä‘Ã³ lÃ  thay Ä‘á»•i má»¥c `nghe` trong tá»‡p cáº¥u hÃ¬nh PHP-FPM tá»« Ä‘á»‹a chá»‰ IP thÃ nh tá»‡p, sau Ä‘Ã³ thay Ä‘á»•i` fastcgi_pass` trong Nginx thÃ nh tá»‡p cÃ³ tiá»n tá»‘ `unix : `vÃ  sáº½ á»•n thÃ´i. Sau khi tÃ´i thay Ä‘á»•i nÃ³, tÃ´i thá»±c sá»± nghÄ© ráº±ng nÃ³ Ä‘Ã£ á»•n, nhÆ°ng thá»±c táº¿ cá»§a `` 502 Bad Gateway` Ä‘Ã£ phÃ¡ vá»¡ áº£o tÆ°á»Ÿng cá»§a tÃ´i, nÃ³ cÃ³ váº» khÃ´ng Ä‘Æ¡n giáº£n nhÆ° váº­y ...
Sau Ä‘Ã³, tÃ´i Ä‘Ã£ xem xÃ©t ká»¹ hÆ¡n cÃ¡c nháº­n xÃ©t cá»§a tá»‡p PHP-FPM vÃ  tÃ¬m tháº¥y cáº£nh bÃ¡o:
``
; Cáº¢NH BÃO: Náº¿u báº¡n chuyá»ƒn sang á»• cáº¯m unix, báº¡n pháº£i cáº¥p quyá»n cho ngÆ°á»i dÃ¹ng mÃ¡y chá»§ web cá»§a mÃ¬nh
; truy cáº­p vÃ o á»• cáº¯m Ä‘Ã³ báº±ng cÃ¡ch Ä‘áº·t Listen.acl_users thÃ nh ngÆ°á»i dÃ¹ng mÃ¡y chá»§ web.
``
á»’, hÃ³a ra lÃ  `nghe.acl_users` ... Sau Ä‘Ã³, tÃ´i thÃªm nginx, vÃ  nÃ³ á»•n sau khi khá»Ÿi Ä‘á»™ng láº¡i.
TÃ´i dá»± Ä‘á»‹nh tá»‘i Æ°u hÃ³a MySQL sau nÃ y, nhÆ°ng tÃ´i khÃ´ng biáº¿t cÃ¡ch thiáº¿t láº­p á»• cáº¯m miá»n UNIX trong MySQL. Ban Ä‘áº§u tÃ´i Ä‘á»‹nh bá» qua, nhÆ°ng tÃ´i nghe nÃ³i ráº±ng cÃ³ váº» nhÆ° `127.0.0.1` tá»‘t hÆ¡n` localhost` trong káº¿t ná»‘i cÆ¡ sá»Ÿ dá»¯ liá»‡u, bá»Ÿi vÃ¬ Má»™t phÃ¢n tÃ­ch Ã­t hÆ¡n. TÃ´i nghe ráº±ng nÃ³ cÃ³ váº» cÃ³ lÃ½, vÃ  sau Ä‘Ã³ tÃ´i Ä‘Ã£ thay Ä‘á»•i Ä‘á»‹a chá»‰ cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a cáº¥u hÃ¬nh trang web.
NhÆ°ng sau Ä‘Ã³ tÃ´i phÃ¡t hiá»‡n ra ráº±ng tÃ´i Ä‘Ã£ kiá»ƒm tra nÃ³ vÃ  tháº¥y ráº±ng cÃ³ váº» nhÆ° MySQL cÃ³ quy Ä‘á»‹nh Ä‘áº·c biá»‡t cho Ä‘á»‹a chá»‰ `localhost`. Náº¿u báº¡n sá»­ dá»¥ng` localhost` trong MySQL, thÃ¬ káº¿t ná»‘i sáº½ Ä‘i qua cÃ¡c á»• cáº¯m miá»n UNIX vÃ  viá»‡c sá»­ dá»¥ng ` 127.0.0.1` sáº½ hoáº¡t Ä‘á»™ng nhÆ° bÃ¬nh thÆ°á»ng. CÃ¡c á»• cáº¯m TCP / IP.
Sau khi Ä‘á»c xong, tÃ´i cáº£m tháº¥y hÆ¡i khÃ³ chá»‹u, sau Ä‘Ã³ tÃ´i quay láº¡i vÃ  thay Ä‘á»•i Ä‘á»‹a chá»‰ cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a mÃ¬nh, khÃ´ng nhá»¯ng tháº¿, tÃ´i cÃ²n Ä‘á»‹nh táº¯t cá»•ng 3306. Sau Ä‘Ã³, tÃ´i kiá»ƒm tra vÃ  tháº¥y ráº±ng cáº¥u hÃ¬nh Ä‘Ã£ thÃªm tÃ­nh nÄƒng bá» qua máº¡ng. táº­p tin. `ÄÃ³ lÃ  nÃ³.
Sau Ä‘Ã³, tÃ´i kiá»ƒm tra cÃ¡c cá»•ng, ngoÃ i cá»•ng 443 vÃ  cá»•ng SSH cá»§a tÃ´i, cÃ²n cÃ³ má»™t cá»•ng láº¡ 25. TÃ´i cáº£m tháº¥y ráº¥t khÃ³ chá»‹u, tÃ´i Ä‘Ã£ kiá»ƒm tra cá»•ng cá»§a postfix, vÃ  sau Ä‘Ã³ tÃ´i gá»¡ cÃ i Ä‘áº·t postfix khi tÃ´i khÃ³ chá»‹u.
Sau Ä‘Ã³, tÃ´i xem láº¡i nháº­t kÃ½ Nginx cá»§a mÃ¬nh vÃ  tháº¥y ráº±ng kÃ­ch thÆ°á»›c hÆ¡i sai, nháº­t kÃ½ mÃ¡y chá»§ vá»«a Ä‘Æ°á»£c xÃ¢y dá»±ng lÃ  400-500 MiB? ! Máº·c dÃ¹ lÆ°u lÆ°á»£ng cá»§a Há»c viá»‡n Hoa Hoa lÃºc thÆ°á»ng khÃ´ng nhá», nhÆ°ng cÅ©ng khÃ´ng nÃªn phÃ³ng Ä‘áº¡i nhÆ° váº­y, Ä‘Ãºng khÃ´ng? Sau Ä‘Ã³, tÃ´i tháº¥y ráº±ng tÃ´i Ä‘Ã£ khÃ´ng lá»c cÃ¡c báº£n ghi tÃ i nguyÃªn tÄ©nh, vÃ  sau Ä‘Ã³ sá»­a Ä‘á»•i tá»‡p cáº¥u hÃ¬nh má»™t chÃºt, vÃ  tÃ´i cáº£m tháº¥y thoáº£i mÃ¡i hÆ¡n ğŸ˜.
VÃ¬ váº­y, viá»‡c tá»‘i Æ°u hÃ³a Huahuo Academy káº¿t thÃºc á»Ÿ Ä‘Ã¢y.

# TÃ¡i bÃºt
TÃ´i thá»±c sá»± nÃªn xem xÃ©t ká»¹ hÆ¡n báº£n ghi, cÃ³ thá»ƒ BUG xuáº¥t hiá»‡n khÃ´ng thá»ƒ giáº£i thÃ­ch Ä‘Æ°á»£c lÃ  má»™t cuá»™c táº¥n cÃ´ng? ~~ (áº¢o tÆ°á»Ÿng bá»‹ bá»©c háº¡i 23333) ~~ Sau nÃ y, tÃ´i xem qua nháº­t kÃ½ vÃ  hÃ¬nh nhÆ° tÃ´i khÃ´ng cÃ³ xu hÆ°á»›ng nÃ y.
NgoÃ i ra, tÃ´i thá»±c sá»± khÃ´ng nÃªn Ä‘áº·t dá»± Ã¡n Ä‘ang phÃ¡t triá»ƒn vÃ  trang web chÃ­nh trÃªn cÃ¹ng má»™t mÃ¡y chá»§, Ã­t nháº¥t lÃ  trá»©ng khÃ´ng nÃªn Ä‘á»ƒ cÃ¹ng má»™t giá» ... Láº§n nÃ y tÃ´i dá»± Ä‘á»‹nh lÃ m táº¥t cáº£ cÃ¡c cáº¥u hÃ¬nh cá»§a trang web chÃ­nh Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng nÃ³ cháº¡y bÃ¬nh thÆ°á»ng.
