---
bá»‘ cá»¥c: bÃ i
title: CÃ¡ nhÃ¢n tráº£i nghiá»‡m kinh nghiá»‡m sáº£n xuáº¥t WeChat push
tags: [WeChat, push]
---

Cáº£m Æ¡n cÃ¡c báº¡n Ä‘Ã£ hoÃ n thÃ nh pháº§n phá»©c táº¡p nháº¥t ğŸ˜‚ <! - more ->

# NguyÃªn nhÃ¢n
TÃ´i Ä‘Ã£ viáº¿t [PhiÃªn báº£n Mini Beta cá»§a MÃ¡y chá»§ Sauce] (/ 2021/02/02 / serverchan.html) vÃ o thÃ¡ng trÆ°á»›c, sau Ä‘Ã³ cÃ³ má»™t ngÆ°á»i tÃªn lÃ  [guanzi008] (https://github.com/guanzi008) TÃ´i Ä‘Ã£ xem bÃ i viáº¿t cá»§a tÃ´i vÃ  sáºµn sÃ ng cung cáº¥p cho tÃ´i tÃ i khoáº£n chÃ­nh thá»©c Ä‘Æ°á»£c WeChat chá»©ng nháº­n Ä‘á»ƒ tÃ´i tráº£i nghiá»‡m thá»±c táº¿ quy trÃ¬nh sáº£n xuáº¥t nÆ°á»›c sá»‘t Server. TÃ´i ráº¥t biáº¿t Æ¡n vÃ¬ Ä‘iá»u nÃ y vÃ  Ä‘Ã£ hoÃ n thÃ nh nhá»¯ng viá»‡c phá»©c táº¡p nháº¥t. Giá»‘ng nhÆ° nÆ°á»›c sá»‘t MÃ¡y chá»§, ná»n táº£ng nÃ³i ráº±ng Ä‘iá»u duy nháº¥t mÃ  Ta lÃ m lÃ  Ä‘Äƒng kÃ½ má»™t tÃ i khoáº£n chÃ­nh thá»©c Ä‘Æ°á»£c WeChat chá»©ng nháº­n. Sau cÃ¹ng, nhá»¯ng ngÆ°á»i ngu ngá»‘c cÃ³ thá»ƒ hiá»ƒu Ä‘Æ°á»£c cÃ¡c tÃ i liá»‡u má»Ÿ wechat vÃ  khÃ´ng cÃ³ khÃ³ khÄƒn vá» ká»¹ thuáº­t.
TÃ¬nh cá» lÃ  láº§n nÃ y tÃ´i Ä‘Ã£ cÃ³ cÆ¡ há»™i Ä‘á»ƒ thá»±c sá»± tráº£i nghiá»‡m sá»± khÃ¡c biá»‡t giá»¯a tÃ i khoáº£n thá»­ nghiá»‡m vÃ  tÃ i khoáº£n dá»‹ch vá»¥ Ä‘Ã£ vÆ°á»£t qua chá»©ng nháº­n WeChat.

# Tráº£i nghiá»‡m thá»±c táº¿
Máº·c dÃ¹ trÆ°á»›c Ä‘Ã¢y tÃ´i khÃ´ng cÃ³ tÃ i khoáº£n chÃ­nh thá»©c Ä‘Æ°á»£c WeChat chá»©ng nháº­n, nhÆ°ng tÃ´i Ä‘Ã£ tá»«ng sá»­ dá»¥ng tÃ i khoáº£n chÃ­nh thá»©c cÃ¡ nhÃ¢n do má»™t ngÆ°á»i báº¡n cÃ¹ng lá»›p Ä‘Äƒng kÃ½. Äiá»u Ä‘Ã³ thá»±c sá»± lÃ£ng phÃ­ vÃ  háº§u nhÆ° táº¥t cáº£ cÃ¡c giao diá»‡n Ä‘á»u khÃ´ng thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c ... BÃ¢y giá» tÃ´i Ä‘Ã£ cÃ³ WeChat - tÃ i khoáº£n chÃ­nh thá»©c Ä‘Æ°á»£c xÃ¡c nháº­n, tÃ´i tháº¥y ráº±ng cÃ¡i nÃ y ráº¥t tá»‘t., Vá» cÆ¡ báº£n táº¥t cáº£ cÃ¡c chá»©c nÄƒng nÃªn cÃ³, nhÆ°ng cÃ³ má»™t sá»‘ nÆ¡i cÃ³ lá»£i tháº¿ riÃªng cá»§a há» vÃ  sá»‘ thá»­ nghiá»‡m. VÃ­ dá»¥: viá»‡c giÃ¡m sÃ¡t cÃ¡c tÃ i khoáº£n thá»­ nghiá»‡m dá»… dÃ ng hÆ¡n nhiá»u, giá»‘ng nhÆ° tin nháº¯n máº«u, khÃ´ng cÃ³ háº¡n cháº¿ nÃ o cáº£ vÃ  cho dÃ¹ báº¡n Ä‘Äƒng ná»™i dung gÃ¬, báº¡n cÅ©ng khÃ´ng pháº£i lo láº¯ng vá» tÃ i khoáº£n. Viá»‡c giÃ¡m sÃ¡t tÃ i khoáº£n cÃ´ng khai Ä‘Æ°á»£c chá»©ng nháº­n nÃ y nghiÃªm ngáº·t hÆ¡n nhiá»u vÃ  báº¡n khÃ´ng Ä‘Æ°á»£c nghÄ© Ä‘áº¿n viá»‡c trá»±c tiáº¿p gá»­i cÃ¡c tin nháº¯n báº¥t há»£p phÃ¡p. NgÆ°á»i ta nÃ³i ráº±ng cÃ¡c tin nháº¯n máº«u cÅ©ng pháº£i sá»­ dá»¥ng cÃ¡c máº«u hiá»‡n cÃ³ vÃ  nhá»¯ng tin nháº¯n khÃ´ng pháº£i qua kiá»ƒm tra. NgoÃ i ra, tÃ´i cáº£m tháº¥y ráº±ng cÃ¡i gá»i lÃ  tin nháº¯n máº«u ngoáº¡i tuyáº¿n pháº£i lÃ  má»™t quáº£ bom khÃ³i. TÃ i liá»‡u chÃ­nh thá»©c nÃ³i ráº¥t rÃµ rÃ ng ráº±ng chá»©c nÄƒng thÃ´ng bÃ¡o Ä‘Äƒng kÃ½ tÃ i khoáº£n dá»‹ch vá»¥ ** báº­t kiá»ƒm tra mÃ u xÃ¡m vÃ  kháº£ nÄƒng tin nháº¯n máº«u cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng bÃ¬nh thÆ°á»ng **, vÃ¬ váº­y Ä‘á»«ng quÃ¡ lo láº¯ng.
TÃ´i Ä‘Ã£ thá»­ cÃ¡i gá»i lÃ  chá»©c nÄƒng thÃ´ng bÃ¡o Ä‘Äƒng kÃ½. NÃ³ tháº­t tá»‡. Náº¿u báº¡n muá»‘n push, báº¡n pháº£i cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘á»“ng Ã½, vÃ  Ä‘Ã³ lÃ  má»i lÃºc, cÃ³ nghÄ©a lÃ  ngÆ°á»i dÃ¹ng chá»‰ cÃ³ quyá»n thÃ´ng bÃ¡o má»™t láº§n, vÃ¬ váº­y nÃ³ lÃ  ráº¥t lÃ£ng phÃ­. CÃ³ má»™t Ä‘Äƒng kÃ½ dÃ i háº¡n, ráº¥t ráº¯c rá»‘i. May máº¯n thay, thÃ´ng bÃ¡o máº«u hiá»‡n cÃ³ sáºµn miá»…n lÃ  báº¡n Ã¡p dá»¥ng. VÃ¬ váº­y, tiáº¿p theo, tÃ´i Ä‘Ã£ cáº£i thiá»‡n mÃ£ mÃ  tÃ´i Ä‘Ã£ sá»­ dá»¥ng trÃªn tÃ i khoáº£n thá»­ nghiá»‡m, thÃªm bá»™ Ä‘á»‡m Access Token, cÃ¡c yÃªu cáº§u POST Ä‘Æ°á»£c há»— trá»£ vÃ  thÃªm cÃ¡c chá»©c nÄƒng nhÆ° trá»«u tÆ°á»£ng, HTML vÃ  Markdown. MÃ£ nhÆ° sau:---
layout: post
title: CÃ¡ nhÃ¢n tráº£i nghiá»‡m kinh nghiá»‡m sáº£n xuáº¥t WeChat push
tags: [WeChat, push]
---

Cáº£m Æ¡n cÃ¡c báº¡n Ä‘Ã£ hoÃ n thÃ nh pháº§n phá»©c táº¡p nháº¥t ğŸ˜‚ <! - more ->

# NguyÃªn nhÃ¢n
TÃ´i Ä‘Ã£ viáº¿t [PhiÃªn báº£n Mini Beta cá»§a MÃ¡y chá»§ Sauce] (/ 2021/02/02 / serverchan.html) vÃ o thÃ¡ng trÆ°á»›c, sau Ä‘Ã³ cÃ³ má»™t ngÆ°á»i tÃªn lÃ  [guanzi008] (https://github.com/guanzi008) TÃ´i Ä‘Ã£ xem bÃ i viáº¿t cá»§a tÃ´i vÃ  sáºµn sÃ ng cung cáº¥p cho tÃ´i tÃ i khoáº£n chÃ­nh thá»©c Ä‘Æ°á»£c WeChat chá»©ng nháº­n Ä‘á»ƒ tÃ´i tráº£i nghiá»‡m thá»±c táº¿ quy trÃ¬nh sáº£n xuáº¥t nÆ°á»›c sá»‘t Server. TÃ´i ráº¥t biáº¿t Æ¡n vÃ¬ Ä‘iá»u nÃ y vÃ  Ä‘Ã£ hoÃ n thÃ nh nhá»¯ng viá»‡c phá»©c táº¡p nháº¥t. Giá»‘ng nhÆ° nÆ°á»›c sá»‘t MÃ¡y chá»§, ná»n táº£ng nÃ³i ráº±ng Ä‘iá»u duy nháº¥t mÃ  Ta lÃ m lÃ  Ä‘Äƒng kÃ½ má»™t tÃ i khoáº£n chÃ­nh thá»©c Ä‘Æ°á»£c WeChat chá»©ng nháº­n. Sau cÃ¹ng, nhá»¯ng ngÆ°á»i ngu ngá»‘c cÃ³ thá»ƒ hiá»ƒu Ä‘Æ°á»£c cÃ¡c tÃ i liá»‡u má»Ÿ wechat vÃ  khÃ´ng cÃ³ khÃ³ khÄƒn vá» ká»¹ thuáº­t.
TÃ¬nh cá» lÃ  láº§n nÃ y tÃ´i Ä‘Ã£ cÃ³ cÆ¡ há»™i Ä‘á»ƒ thá»±c sá»± tráº£i nghiá»‡m sá»± khÃ¡c biá»‡t giá»¯a tÃ i khoáº£n thá»­ nghiá»‡m vÃ  tÃ i khoáº£n dá»‹ch vá»¥ Ä‘Ã£ vÆ°á»£t qua chá»©ng nháº­n WeChat.

# Tráº£i nghiá»‡m thá»±c táº¿
Máº·c dÃ¹ trÆ°á»›c Ä‘Ã¢y tÃ´i khÃ´ng cÃ³ tÃ i khoáº£n chÃ­nh thá»©c Ä‘Æ°á»£c WeChat chá»©ng nháº­n, nhÆ°ng tÃ´i Ä‘Ã£ tá»«ng sá»­ dá»¥ng tÃ i khoáº£n chÃ­nh thá»©c cÃ¡ nhÃ¢n do má»™t ngÆ°á»i báº¡n cÃ¹ng lá»›p Ä‘Äƒng kÃ½. Äiá»u Ä‘Ã³ thá»±c sá»± lÃ£ng phÃ­ vÃ  háº§u nhÆ° táº¥t cáº£ cÃ¡c giao diá»‡n Ä‘á»u khÃ´ng thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c ... BÃ¢y giá» tÃ´i Ä‘Ã£ cÃ³ WeChat - tÃ i khoáº£n chÃ­nh thá»©c Ä‘Æ°á»£c xÃ¡c nháº­n, tÃ´i tháº¥y ráº±ng cÃ¡i nÃ y ráº¥t tá»‘t., Vá» cÆ¡ báº£n táº¥t cáº£ cÃ¡c chá»©c nÄƒng nÃªn cÃ³, nhÆ°ng cÃ³ má»™t sá»‘ nÆ¡i cÃ³ lá»£i tháº¿ riÃªng cá»§a há» vÃ  sá»‘ thá»­ nghiá»‡m. VÃ­ dá»¥: viá»‡c giÃ¡m sÃ¡t cÃ¡c tÃ i khoáº£n thá»­ nghiá»‡m dá»… dÃ ng hÆ¡n nhiá»u, giá»‘ng nhÆ° tin nháº¯n máº«u, khÃ´ng cÃ³ háº¡n cháº¿ nÃ o cáº£ vÃ  cho dÃ¹ báº¡n Ä‘Äƒng ná»™i dung gÃ¬, báº¡n cÅ©ng khÃ´ng pháº£i lo láº¯ng vá» tÃ i khoáº£n. Viá»‡c giÃ¡m sÃ¡t tÃ i khoáº£n cÃ´ng khai Ä‘Æ°á»£c chá»©ng nháº­n nÃ y nghiÃªm ngáº·t hÆ¡n nhiá»u vÃ  báº¡n khÃ´ng Ä‘Æ°á»£c nghÄ© Ä‘áº¿n viá»‡c trá»±c tiáº¿p gá»­i cÃ¡c tin nháº¯n báº¥t há»£p phÃ¡p. NgÆ°á»i ta nÃ³i ráº±ng cÃ¡c tin nháº¯n máº«u cÅ©ng pháº£i sá»­ dá»¥ng cÃ¡c máº«u hiá»‡n cÃ³ vÃ  nhá»¯ng tin nháº¯n khÃ´ng pháº£i qua kiá»ƒm tra. NgoÃ i ra, tÃ´i cáº£m tháº¥y ráº±ng cÃ¡i gá»i lÃ  tin nháº¯n máº«u ngoáº¡i tuyáº¿n pháº£i lÃ  má»™t quáº£ bom khÃ³i. TÃ i liá»‡u chÃ­nh thá»©c nÃ³i ráº¥t rÃµ rÃ ng ráº±ng chá»©c nÄƒng thÃ´ng bÃ¡o Ä‘Äƒng kÃ½ tÃ i khoáº£n dá»‹ch vá»¥ ** báº­t kiá»ƒm tra mÃ u xÃ¡m vÃ  kháº£ nÄƒng tin nháº¯n máº«u cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng bÃ¬nh thÆ°á»ng **, vÃ¬ váº­y Ä‘á»«ng quÃ¡ lo láº¯ng.
TÃ´i Ä‘Ã£ thá»­ cÃ¡i gá»i lÃ  chá»©c nÄƒng thÃ´ng bÃ¡o Ä‘Äƒng kÃ½. NÃ³ tháº­t tá»‡. Náº¿u báº¡n muá»‘n push, báº¡n pháº£i cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘á»“ng Ã½, vÃ  Ä‘Ã³ lÃ  má»i lÃºc, cÃ³ nghÄ©a lÃ  ngÆ°á»i dÃ¹ng chá»‰ cÃ³ quyá»n thÃ´ng bÃ¡o má»™t láº§n, vÃ¬ váº­y nÃ³ lÃ  ráº¥t lÃ£ng phÃ­. CÃ³ má»™t Ä‘Äƒng kÃ½ dÃ i háº¡n, ráº¥t ráº¯c rá»‘i. May máº¯n thay, thÃ´ng bÃ¡o máº«u hiá»‡n cÃ³ sáºµn miá»…n lÃ  báº¡n Ã¡p dá»¥ng. VÃ¬ váº­y, tiáº¿p theo, tÃ´i Ä‘Ã£ cáº£i thiá»‡n mÃ£ mÃ  tÃ´i Ä‘Ã£ sá»­ dá»¥ng trÃªn tÃ i khoáº£n thá»­ nghiá»‡m, thÃªm bá»™ Ä‘á»‡m Access Token, cÃ¡c yÃªu cáº§u POST Ä‘Æ°á»£c há»— trá»£ vÃ  thÃªm cÃ¡c chá»©c nÄƒng nhÆ° trá»«u tÆ°á»£ng, HTML vÃ  Markdown. MÃ£ nhÆ° sau:
```php
<?php
$appid='å…¬ä¼—å·APPID';
$secret='å…¬ä¼—å·Secret';
$userid=$_GET['userid'];
$template_id='æ¨¡æ¿ID';
$title=addslashes($_REQUEST['title']);
$summary=addslashes($_REQUEST['summary']);
$content=addslashes($_REQUEST['content']);

$addHTML="";
session_id('Storagepush');
session_start();
if(!$summary){
    $summary=$content;
}
if(!json_decode(file_get_contents('https://api.weixin.qq.com/cgi-bin/get_api_domain_ip?access_token='.$_SESSION['access_token']),true)['ip_list']){
$_SESSION['access_token']=json_decode(file_get_contents('https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid='.$appid.'&secret='.$secret),true)['access_token'];
}
if($_GET['type'] == "md"){
    include_once("Parsedown.php");
    $Parsedown = new Parsedown();
    //$Parsedown->setSafeMode(true);
    $content = $Parsedown->text($content);
    $_GET['type'] = "html";
}
if($_GET['type'] == "html"){
    $filename='html/'.md5(uniqid(mt_rand(), true)).'.html';
    file_put_contents($filename, '<meta name="viewport" content="width=device-width, initial-scale=1"><title>'.$title.'</title><h1>'.$title.'</h1><hr>'.$content.'<hr><center>Powered By <a href="https://mabbs.github.io/">Mayx</a></center>');
    $addHTML='"url":"https://'.$_SERVER['HTTP_HOST'].'/'.$filename.'", ';
}

echo file_get_contents('https://api.weixin.qq.com/cgi-bin/message/template/send?access_token='.$_SESSION['access_token'], false, stream_context_create(array('http' => array('method'=>'post','header'=>"Content-Type: application/json;charset=utf-8",'content'=>'{"touser":"'.$userid.'","template_id":"'.$template_id.'", '.$addHTML.'"data":{"first": {"value":"'.$title.'"}, "keyword1": {"value":"'.$summary.'"}, "keyword2": {"value":"'.date('Y-m-d H:i:s').'"}}}'))));
```
Náº¿u báº¡n muá»‘n sá»­ dá»¥ng mÃ£ nÃ y, báº¡n cáº§n sá»­ dá»¥ng thÆ° viá»‡n cá»§a [Parsedown] (https://github.com/erusev/parsedown). NgoÃ i ra, tÃ´i Ä‘Ã£ sá»­ dá»¥ng máº«u cÃ³ ID lÃ  `OPENTM207965242` cho thÃ´ng bÃ¡o máº«u Náº¿u ai Ä‘Ã³ muá»‘n sá»­ dá»¥ng nÃ³, NÃªn sá»­ dá»¥ng cÃ¹ng má»™t máº«u.
NgoÃ i ra, Ä‘á»‘i vá»›i viá»‡c láº¥y OPENID cá»§a ngÆ°á»i dÃ¹ng ... Náº¿u báº¡n muá»‘n sá»­ dá»¥ng nÃ³, hÃ£y tá»± nghÄ© ra giáº£i phÃ¡p, viá»‡c láº¥y OPENID ráº¥t Ä‘Æ¡n giáº£n.
Theo quan Ä‘iá»ƒm kinh nghiá»‡m, nÃ³ nÃªn lÃ  loáº¡i rÃ¡c rÆ°á»Ÿi Ä‘Ã¡nh mÃ¡y chá»§, vÃ  chÆ°a cÃ³ quáº£ng cÃ¡o. Vá» máº·t lÃ½ thuyáº¿t, Ã¢m lÆ°á»£ng Ä‘áº©y tá»‘i Ä‘a hÃ ng ngÃ y lÃ  10w láº§n. Khi sá»‘ lÆ°á»£ng ngÆ°á»i hÃ¢m má»™ tÃ i khoáº£n vÆ°á»£t quÃ¡ 10W / 100W / 1000W, giá»›i háº¡n cuá»™c gá»i hÃ ng ngÃ y cá»§a tin nháº¯n máº«u sáº½ Ä‘Æ°á»£c tÄƒng lÃªn tÆ°Æ¡ng á»©ng. NhÆ°ng Ä‘Ã¢y khÃ´ng pháº£i lÃ  chá»‘ng láº¡m dá»¥ng, vÃ¬ váº­y báº¡n váº«n cáº§n chÃº Ã½ Ä‘áº¿n nÃ³.

# Sá»­ dá»¥ng tÃ i liá»‡u

| Tham sá»‘ | Báº¯t buá»™c | PhÆ°Æ¡ng thá»©c YÃªu cáº§u | Ná»™i dung |
| - | - | - | - |
| userid | yes | GET | user OPENID |
| loáº¡i | KhÃ´ng | GET | html / md / rá»—ng |
| title | No | GET / POST | Title |
| tÃ³m táº¯t | KhÃ´ng | GET / POST | TÃ³m táº¯t (náº¿u báº¡n khÃ´ng Ä‘iá»n, máº·c Ä‘á»‹nh lÃ  ná»™i dung) |
| ná»™i dung | KhÃ´ng | GET / POST | content |

# Cáº£i tiáº¿n tiáº¿p theo
Má»i ngÆ°á»i trong tÃ i khoáº£n chÃ­nh thá»©c mÃ  tÃ´i hiá»‡n Ä‘ang sá»­ dá»¥ng Ä‘á»u hy vá»ng cÃ³ má»™t ná»n táº£ng nhÆ° WxPusher. TÃ´i cÃ³ thá»ƒ Ä‘Ã£ xem qua thá»© Ä‘Ã³ vÃ  hÃ³a ra nÃ³ chá»‰ lÃ  rÃ¡c rÆ°á»Ÿi. Äá»ƒ Ä‘áº©y, báº¡n pháº£i sá»­ dá»¥ng API dÃ nh riÃªng cho ná»n táº£ng, bao gá»“m cáº£ SDK nguá»“n má»Ÿ táº¥t cáº£ Ä‘á»u lá»™n xá»™n. NÃ³ Ä‘Æ°á»£c thiáº¿t káº¿ cho cÃ¡i gá»i lÃ  ná»n táº£ng Ä‘áº©y vÃ  viá»‡c lá»±a chá»n cÃ¡c máº«u thá»±c sá»± vÃ´ vá»‹ vÃ  tráº£i nghiá»‡m thá»±c sá»± á»Ÿ má»©c trung bÃ¬nh. VÃ¬ váº­y, cÃ³ váº» nhÆ° khÃ´ng cÃ³ ná»n táº£ng Ä‘áº©y WeChat mÃ£ nguá»“n má»Ÿ phÃ¹ há»£p, vÃ¬ váº­y hÃ£y Ä‘á»ƒ tÃ´i thá»­ tiáº¿p theo, Ä‘á»ƒ tÃ´i xem táº¡i sao khÃ´ng ai muá»‘n táº¡o má»™t ná»n táº£ng Ä‘áº©y WeChat mÃ£ nguá»“n má»Ÿ!
